#!/usr/bin/env python3
import argparse
from os.path import join
import sys

from bdd_tester import bdd_tester


if __name__ == '__main__':
    default_feature_paths = [join('features', 'index_2017')]

    parser = argparse.ArgumentParser(description='Write IATI data tests in gherkin.')
    parser.add_argument('filepath', help='IATI XML file to test')
    parser.add_argument('-f', '--feature', help='path(s) to test files', action='append', dest='features')
    parser.add_argument('-o', '--output', help='output path for results', dest='output_path')
    parser.add_argument('-t', '--today', metavar='DATE', help='specify a date to be used as today\'s date (YYYY-MM-DD)')

    args = vars(parser.parse_args())
    if args['features'] == []:
        args['features'] = default_feature_paths

    failed = False
    try:
        bdd_tester(**args)
    except Exception as e:
        print(e)
        failed = True

    sys.exit(1 if failed else 0)
